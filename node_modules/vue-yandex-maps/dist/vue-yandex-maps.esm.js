"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("vue");const t=Symbol();const o=new class{events;ymapReady;scriptIsNotAttached;pluginInstalledGlobal;constructor(){this.events={},this.ymapReady=!1,this.scriptIsNotAttached=!0,this.pluginInstalledGlobal=!1}$on(e,t){return this.events[e]||(this.events[e]=[]),this.events[e].push(t),()=>{this.events[e]=this.events[e].filter((e=>t!==e))}}$emit(e){const t=this.events[e];t&&t.forEach((e=>e()))}};function n(e){return new Promise(((t,n)=>{if(window.ymaps)return t(!0);if(document.getElementById("vue-yandex-maps-script"))return void o.$on("scriptIsLoaded",t);const a=document.createElement("SCRIPT"),{apiKey:s="",lang:r="ru_RU",version:d="2.1",coordorder:c="latlong",debug:l=!1,enterprise:i=!1}=e,p=`https://${i?"enterprise.":""}api-maps.yandex.ru/${d}/?${`lang=${r}${s&&`&apikey=${s}`}&mode=${l?"debug":"release"}&coordorder=${c}`}`;a.setAttribute("src",p),a.setAttribute("async",""),a.setAttribute("defer",""),a.setAttribute("id","vue-yandex-maps-script"),document.head.appendChild(a),o.scriptIsNotAttached=!1,a.onload=(e=>()=>{ymaps.ready((()=>{o.ymapReady=!0,o.$emit("scriptIsLoaded"),e(!0)}))})(t),a.onerror=n}))}const a=e=>Array.isArray(e)?e.map(a):+e,s=["actionbegin","actionbreak","actionend","actiontick","actiontickcomplete","balloonclose","balloonopen","boundschange","click","contextmenu","dblclick","destroy","hintclose","hintopen","marginchange","mousedown","mouseenter","mouseleave","mousemove","mouseup","multitouchend","multitouchmove","multitouchstart","optionschange","sizechange","typechange","wheel"],r=["balloonclose","balloonopen","beforedrag","beforedragstart","click","contextmenu","dblclick","drag","dragend","dragstart","editorstatechange","geometrychange","hintclose","hintopen","mapchange","mousedown","mouseenter","mouseleave","mousemove","mouseup","multitouchend","multitouchmove","multitouchstart","optionschange","overlaychange","parentchange","propertieschange","wheel"];function d(e,t=!1){const o=[],n=[];let a,s;return{addGeoObject:(n,s)=>{o.push(t?s:n),clearTimeout(a),a=window.setTimeout((()=>e(o,"add")))},deleteGeoObject:(o,a)=>{n.push(t?a:o),clearTimeout(s),s=window.setTimeout((()=>e(n,"remove")))}}}var c=e.defineComponent({name:"YandexMap",props:{coordinates:{type:Array,required:!0},zoom:{type:Number,default:10},bounds:{type:Array,default:null},behaviors:{type:Array,default:null},controls:{type:Array,default:null},detailedControls:{type:Object,default:null},events:{type:Array,default:()=>["click"],validator:e=>e.every((e=>s.includes(e)))},mapType:{type:String,default:"map"},settings:{type:Object,default:()=>({})}},emits:[...s,"geo-objects-updated","created"],setup(a,{emit:s,slots:r,expose:c}){const l=e.ref(!1),i=o.pluginInstalledGlobal&&e.inject("pluginOptions")||{};let p;const u=`yandexMap${Math.round(1e5*Math.random())}`,{addGeoObject:m,deleteGeoObject:b}=d(((e,t)=>{p&&e.length&&(e.forEach((e=>p?.geoObjects[t](e))),s("geo-objects-updated",p.geoObjects),e=[])}));e.provide(t,{addGeoObject:m,deleteGeoObject:b});const y=()=>{if(l.value=!0,p=new ymaps.Map(u,{center:a.coordinates,zoom:a.zoom,bounds:a.bounds,behaviors:a.behaviors,controls:a.controls,type:`yandex#${a.mapType}`}),a.events.forEach((e=>p?.events?.add(e,(t=>s(e,t))))),a.detailedControls){Object.keys(a.detailedControls).forEach((e=>{p?.controls.remove(e),p?.controls.add(e,a.detailedControls?.[e])}))}s("created",p)};if(o.scriptIsNotAttached){n({...i,...a.settings})}return o.ymapReady?ymaps.ready(y):o.$on("scriptIsLoaded",y),c(p),()=>e.h("section",{class:"yandex-container","data-test":"map"},[e.h("div",{id:u,style:"min-height: 100%;"}),l.value&&e.h("div",{style:"display: none;"},[r.default?.()])])}}),l=e.defineComponent({name:"YandexMarker",props:{coordinates:{type:Array,required:!0},markerId:{type:[String,Number],required:!0},properties:{type:Object,default:()=>({})},options:{type:Object,default:null},type:{type:String,default:"Point"},radius:{type:Number,default:null},events:{type:Array,default:()=>["click"],validator:e=>e.every((e=>r.includes(e)))}},emits:[...r],setup(o,{emit:n,slots:s,expose:r}){const{addGeoObject:d,deleteGeoObject:c}=e.inject(t)||{},l=e.computed((()=>o.coordinates.map(a))),i=e.ref(!1),p={geometry:{type:o.type,coordinates:l.value,radius:o.radius},properties:{...o.properties,markerId:o.markerId}},u=s.component?.().length?ymaps.templateLayoutFactory.createClass(`<div id="balloon-${o.markerId}" class="yandex-balloon"><div>`,{build(){u.superclass.build.call(this),i.value=!0},clear(){i.value=!1,u.superclass.clear.call(this)}}):null,m={balloonContentLayout:u,...o.options},b=new ymaps.GeoObject(p,m);o.events.forEach((e=>b.events?.add(e,(t=>n(e,t))))),e.provide("marker",b);const y={...p,options:m};return e.onMounted((()=>{d(b,y)})),e.onBeforeUnmount((()=>{c(b,y)})),r(b),s.component?.().length?()=>i.value&&e.h(e.Teleport,{to:`#balloon-${o.markerId}`},[s.component?.()]):()=>s.default?.()}}),i=e.defineComponent({name:"YandexGeoObjectCollection",props:{options:{type:Object,default:()=>({})}},emits:["geo-objects-updated"],setup(o,{emit:n,expose:a,slots:s}){const r=new ymaps.GeoObjectCollection({},o.options),{addGeoObject:c,deleteGeoObject:l}=e.inject(t)||{},{addGeoObject:i,deleteGeoObject:p}=d(((e,t)=>{r&&e.length&&(e.forEach((e=>r[t](e))),n("geo-objects-updated",r),e=[])}));return e.provide("geoObjectActions",{addGeoObject:i,deleteGeoObject:p}),e.onMounted((()=>{c(r)})),e.onBeforeUnmount((()=>{l(r)})),a(r),()=>s.default?.()}}),p=e.defineComponent({name:"YandexClusterer",props:{options:{type:Object,default:()=>({})}},emits:["geo-objects-updated"],setup(o,{emit:n,expose:a,slots:s}){const r=new ymaps.Clusterer(o.options),{addGeoObject:c,deleteGeoObject:l}=e.inject(t)||{},{addGeoObject:i,deleteGeoObject:p}=d(((e,t)=>{r&&e.length&&(r[t](e),n("geo-objects-updated",r),e=[])}));return e.provide("geoObjectActions",{addGeoObject:i,deleteGeoObject:p}),e.onMounted((()=>{c(r)})),e.onBeforeUnmount((()=>{l(r)})),a(r),()=>s.default?.()}}),u=e.defineComponent({name:"YandexObjectManager",props:{options:{type:Object,default:()=>({})}},emits:["geo-objects-updated"],setup(o,{emit:n,expose:a,slots:s}){const r=new ymaps.ObjectManager(o.options),{addGeoObject:c,deleteGeoObject:l}=e.inject(t)||{},{addGeoObject:i,deleteGeoObject:p}=d(((e,t)=>{if(!r||!e.length)return;const o=e.map((e=>({type:"Feature",id:e.properties.markerId,geometry:e.geometry,properties:e.properties,options:e.options})));r[t](o),n("geo-objects-updated",r),e=[]}),!0);return e.provide("geoObjectActions",{addGeoObject:i,deleteGeoObject:p}),e.onMounted((()=>{c(r)})),e.onBeforeUnmount((()=>{l(r)})),a(r),()=>s.default?.()}});let m;const b=n,y=c,h=l,g=i,j=p,v=u;var f={install:(e,t)=>{m||(m=!0,o.pluginInstalledGlobal=!0,e.provide("pluginOptions",t),e.component("YandexMap",c),e.component("YandexMarker",l),e.component("YandexCollection",i),e.component("YandexClusterer",p),e.component("YandexObjectManager",u))}};exports.YandexClusterer=j,exports.YandexCollection=g,exports.YandexMap=y,exports.YandexMarker=h,exports.YandexObjectManager=v,exports.default=f,exports.loadYmap=b;
//# sourceMappingURL=vue-yandex-maps.esm.js.map
