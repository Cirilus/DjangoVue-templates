import{defineComponent as e,ref as t,inject as o,provide as a,h as n,computed as s,onMounted as r,onBeforeUnmount as d,Teleport as l}from"vue";const c=Symbol();const i=new class{events;ymapReady;scriptIsNotAttached;pluginInstalledGlobal;constructor(){this.events={},this.ymapReady=!1,this.scriptIsNotAttached=!0,this.pluginInstalledGlobal=!1}$on(e,t){return this.events[e]||(this.events[e]=[]),this.events[e].push(t),()=>{this.events[e]=this.events[e].filter((e=>t!==e))}}$emit(e){const t=this.events[e];t&&t.forEach((e=>e()))}};function p(e){return new Promise(((t,o)=>{if(window.ymaps)return t(!0);if(document.getElementById("vue-yandex-maps-script"))return void i.$on("scriptIsLoaded",t);const a=document.createElement("SCRIPT"),{apiKey:n="",lang:s="ru_RU",version:r="2.1",coordorder:d="latlong",debug:l=!1,enterprise:c=!1}=e,p=`https://${c?"enterprise.":""}api-maps.yandex.ru/${r}/?${`lang=${s}${n&&`&apikey=${n}`}&mode=${l?"debug":"release"}&coordorder=${d}`}`;a.setAttribute("src",p),a.setAttribute("async",""),a.setAttribute("defer",""),a.setAttribute("id","vue-yandex-maps-script"),document.head.appendChild(a),i.scriptIsNotAttached=!1,a.onload=(e=>()=>{ymaps.ready((()=>{i.ymapReady=!0,i.$emit("scriptIsLoaded"),e(!0)}))})(t),a.onerror=o}))}const u=e=>Array.isArray(e)?e.map(u):+e,m=["actionbegin","actionbreak","actionend","actiontick","actiontickcomplete","balloonclose","balloonopen","boundschange","click","contextmenu","dblclick","destroy","hintclose","hintopen","marginchange","mousedown","mouseenter","mouseleave","mousemove","mouseup","multitouchend","multitouchmove","multitouchstart","optionschange","sizechange","typechange","wheel"],b=["balloonclose","balloonopen","beforedrag","beforedragstart","click","contextmenu","dblclick","drag","dragend","dragstart","editorstatechange","geometrychange","hintclose","hintopen","mapchange","mousedown","mouseenter","mouseleave","mousemove","mouseup","multitouchend","multitouchmove","multitouchstart","optionschange","overlaychange","parentchange","propertieschange","wheel"];function y(e,t=!1){const o=[],a=[];let n,s;return{addGeoObject:(a,s)=>{o.push(t?s:a),clearTimeout(n),n=window.setTimeout((()=>e(o,"add")))},deleteGeoObject:(o,n)=>{a.push(t?n:o),clearTimeout(s),s=window.setTimeout((()=>e(a,"remove")))}}}var h=e({name:"YandexMap",props:{coordinates:{type:Array,required:!0},zoom:{type:Number,default:10},bounds:{type:Array,default:null},behaviors:{type:Array,default:null},controls:{type:Array,default:null},detailedControls:{type:Object,default:null},events:{type:Array,default:()=>["click"],validator:e=>e.every((e=>m.includes(e)))},mapType:{type:String,default:"map"},settings:{type:Object,default:()=>({})}},emits:[...m,"geo-objects-updated","created"],setup(e,{emit:s,slots:r,expose:d}){const l=t(!1),u=i.pluginInstalledGlobal&&o("pluginOptions")||{};let m;const b=`yandexMap${Math.round(1e5*Math.random())}`,{addGeoObject:h,deleteGeoObject:g}=y(((e,t)=>{m&&e.length&&(e.forEach((e=>m?.geoObjects[t](e))),s("geo-objects-updated",m.geoObjects),e=[])}));a(c,{addGeoObject:h,deleteGeoObject:g});const j=()=>{if(l.value=!0,m=new ymaps.Map(b,{center:e.coordinates,zoom:e.zoom,bounds:e.bounds,behaviors:e.behaviors,controls:e.controls,type:`yandex#${e.mapType}`}),e.events.forEach((e=>m?.events?.add(e,(t=>s(e,t))))),e.detailedControls){Object.keys(e.detailedControls).forEach((t=>{m?.controls.remove(t),m?.controls.add(t,e.detailedControls?.[t])}))}s("created",m)};if(i.scriptIsNotAttached){p({...u,...e.settings})}return i.ymapReady?ymaps.ready(j):i.$on("scriptIsLoaded",j),d(m),()=>n("section",{class:"yandex-container","data-test":"map"},[n("div",{id:b,style:"min-height: 100%;"}),l.value&&n("div",{style:"display: none;"},[r.default?.()])])}}),g=e({name:"YandexMarker",props:{coordinates:{type:Array,required:!0},markerId:{type:[String,Number],required:!0},properties:{type:Object,default:()=>({})},options:{type:Object,default:null},type:{type:String,default:"Point"},radius:{type:Number,default:null},events:{type:Array,default:()=>["click"],validator:e=>e.every((e=>b.includes(e)))}},emits:[...b],setup(e,{emit:i,slots:p,expose:m}){const{addGeoObject:b,deleteGeoObject:y}=o(c)||{},h=s((()=>e.coordinates.map(u))),g=t(!1),j={geometry:{type:e.type,coordinates:h.value,radius:e.radius},properties:{...e.properties,markerId:e.markerId}},v=p.component?.().length?ymaps.templateLayoutFactory.createClass(`<div id="balloon-${e.markerId}" class="yandex-balloon"><div>`,{build(){v.superclass.build.call(this),g.value=!0},clear(){g.value=!1,v.superclass.clear.call(this)}}):null,O={balloonContentLayout:v,...e.options},f=new ymaps.GeoObject(j,O);e.events.forEach((e=>f.events?.add(e,(t=>i(e,t))))),a("marker",f);const G={...j,options:O};return r((()=>{b(f,G)})),d((()=>{y(f,G)})),m(f),p.component?.().length?()=>g.value&&n(l,{to:`#balloon-${e.markerId}`},[p.component?.()]):()=>p.default?.()}}),j=e({name:"YandexGeoObjectCollection",props:{options:{type:Object,default:()=>({})}},emits:["geo-objects-updated"],setup(e,{emit:t,expose:n,slots:s}){const l=new ymaps.GeoObjectCollection({},e.options),{addGeoObject:i,deleteGeoObject:p}=o(c)||{},{addGeoObject:u,deleteGeoObject:m}=y(((e,o)=>{l&&e.length&&(e.forEach((e=>l[o](e))),t("geo-objects-updated",l),e=[])}));return a("geoObjectActions",{addGeoObject:u,deleteGeoObject:m}),r((()=>{i(l)})),d((()=>{p(l)})),n(l),()=>s.default?.()}}),v=e({name:"YandexClusterer",props:{options:{type:Object,default:()=>({})}},emits:["geo-objects-updated"],setup(e,{emit:t,expose:n,slots:s}){const l=new ymaps.Clusterer(e.options),{addGeoObject:i,deleteGeoObject:p}=o(c)||{},{addGeoObject:u,deleteGeoObject:m}=y(((e,o)=>{l&&e.length&&(l[o](e),t("geo-objects-updated",l),e=[])}));return a("geoObjectActions",{addGeoObject:u,deleteGeoObject:m}),r((()=>{i(l)})),d((()=>{p(l)})),n(l),()=>s.default?.()}}),O=e({name:"YandexObjectManager",props:{options:{type:Object,default:()=>({})}},emits:["geo-objects-updated"],setup(e,{emit:t,expose:n,slots:s}){const l=new ymaps.ObjectManager(e.options),{addGeoObject:i,deleteGeoObject:p}=o(c)||{},{addGeoObject:u,deleteGeoObject:m}=y(((e,o)=>{if(!l||!e.length)return;const a=e.map((e=>({type:"Feature",id:e.properties.markerId,geometry:e.geometry,properties:e.properties,options:e.options})));l[o](a),t("geo-objects-updated",l),e=[]}),!0);return a("geoObjectActions",{addGeoObject:u,deleteGeoObject:m}),r((()=>{i(l)})),d((()=>{p(l)})),n(l),()=>s.default?.()}});let f;const G=p,x=h,k=g,A=j,I=v,w=O;var $={install:(e,t)=>{f||(f=!0,i.pluginInstalledGlobal=!0,e.provide("pluginOptions",t),e.component("YandexMap",h),e.component("YandexMarker",g),e.component("YandexCollection",j),e.component("YandexClusterer",v),e.component("YandexObjectManager",O))}};export{I as YandexClusterer,A as YandexCollection,x as YandexMap,k as YandexMarker,w as YandexObjectManager,$ as default,G as loadYmap};
//# sourceMappingURL=vue-yandex-maps.umd.js.map
